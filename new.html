<html>

    <head>
        <title>Shorten! from aviiciii</title>
        <link rel="stylesheet" href="styles.css" />
    </head>

	<body>

		<div class="login-box">
			<form>
				<div class="user-box">
					<input type="text" name="text" value id="linkinput" required="" />
					<label>Url</label>
				</div>
				<div class="user-box">
					<input type="text" name="path" value id="pathinput" required="" />
					<label>Slug</label>
				</div>
				<a href="#" id="myinput" value="Shorten">
					<span></span>
					<span></span>
					<span></span>
					<span></span>
					Shorten
				</a>
			</form>
            <br>
            <div class="msg row">
                <div class="column left">
                    <p id="message">link.laavesh.ml/ </p>
                </div>
                <div class="column right">
                    <button name="copy" id="copy"><img  src="copy.png" width="30px" alt="copy"  /></button>
                </div>
            </div>
		</div>


        <script>    
			document.getElementById("myinput").onclick = function () {
				var link = document.getElementById("linkinput").value;
				var data = {
					domain: "link.laavesh.ml",
					originalURL: link,
					allowDuplicates: false,
				};
                // add custom path if it exists
                if (document.getElementById("pathinput").value != "") {
                    data.path = document.getElementById("pathinput").value;
                }
				fetch("https://api.short.cm/links/public", {
					method: "post",
					headers: {
						accept: "application/json",
						"Content-Type": "application/json",
						authorization: "pk_ynFkEXQHXdWrijOF",
					},
					body: JSON.stringify(data),
				})
					.then(function (response) {
                        return response.json();
					})
					.then(function (data) {
                        if (data.error) {
                            throw data.error;
                        }
                        let url = String(data.shortURL);
                        url =url.replace("https://", "");
                        console.log(url);
						document.getElementById("message").innerHTML =  url;
					})
                    .catch(function (error) {
                        console.log(error);
                        document.getElementById("message").innerHTML = error;
                    });
				document.getElementById("linkinput").value = "";
                document.getElementById("pathinput").value = "";
			};

            document.getElementById("copy").onclick = function () {
                console.log("copy");
                var message = document.getElementById("message");

                // Select the text field
                url = message.innerHTML;
                

                // Copy the text inside the text field
                navigator.clipboard.writeText(url);

                // Alert copied by changing the text
                message.innerHTML = "Copied!";
                setTimeout(function () {
                    message.innerHTML = url;
                }, 800);

                
            }
		</script>

	</body>
</html>
